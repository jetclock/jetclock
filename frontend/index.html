<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analog Clock with Plugins</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=cell_tower,wifi" />
<!--    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=wifi" />-->
    <link rel="stylesheet" href="./src/style.css" />

    <style>
        /* Each slot now does:
           1) translate(-50%,-50%) to center,
           2) rotate(<hourAngle>deg),
           3) translateY(-260px) outward,
           4) rotate(-<hourAngle>deg) back so content is not rotated. */
        #slot-12 {
            transform:
                    translate(-50%, -50%)
                    rotate(0deg)      /* 12 o’clock angle */
                    translateY(-130px)
                    rotate(0deg);     /* counter-rotation */
        }
        #slot-1 {
            transform:
                    translate(-50%, -50%)
                    rotate(30deg)
                    translateY(-130px)
                    rotate(-30deg);
        }
        #slot-2 {
            transform:
                    translate(-50%, -50%)
                    rotate(60deg)
                    translateY(-130px)
                    rotate(-60deg);
        }
        #slot-3 {
            transform:
                    translate(-50%, -50%)
                    rotate(90deg)
                    translateY(-130px)
                    rotate(-90deg);
        }
        #slot-4 {
            transform:
                    translate(-50%, -50%)
                    rotate(120deg)
                    translateY(-130px)
                    rotate(-120deg);
        }
        #slot-5 {
            transform:
                    translate(-50%, -50%)
                    rotate(150deg)
                    translateY(-130px)
                    rotate(-150deg);
        }
        #slot-6 {
            transform:
                    translate(-50%, -50%)
                    rotate(180deg)
                    translateY(-130px)
                    rotate(-180deg);
        }
        #slot-7 {
            transform:
                    translate(-50%, -50%)
                    rotate(210deg)
                    translateY(-130px)
                    rotate(-210deg);
        }
        #slot-8 {
            transform:
                    translate(-50%, -50%)
                    rotate(240deg)
                    translateY(-130px)
                    rotate(-240deg);
        }
        #slot-9 {
            transform:
                    translate(-50%, -50%)
                    rotate(270deg)
                    translateY(-130px)
                    rotate(-270deg);
        }
        #slot-10 {
            transform:
                    translate(-50%, -50%)
                    rotate(300deg)
                    translateY(-130px)
                    rotate(-300deg);
        }
        #slot-11 {
            transform:
                    translate(-50%, -50%)
                    rotate(330deg)
                    translateY(-130px)
                    rotate(-330deg);
        }

        #wifi-mode {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;

            /* 1) Center on clock face, 2) spin to 135°, 3) push out 50px,
               4) spin back 135° so inner icon is not rotated: */
            transform:
                    translate(-50%, -50%)
                    rotate(135deg)
                    translateY(-50px)
                    rotate(-135deg);
            transform-origin: center center;

            /* Flex-center the FontAwesome icon */
            display: flex;
            align-items: center;
            justify-content: center;

            /* Make it invisible (no border/background) until content loads */
            border: none;
            background: transparent;
            box-shadow: none;
        }
    </style>
</head>

<body>
<div class="visually-hidden"></div>
<div id="clock-container">
    <!-- 1) The SVG clock face: -->
    <svg id="clock-svg" viewBox="-50 -50 100 100" xmlns="http://www.w3.org/2000/svg">
        <circle class="clock-face" r="48" fill="#fff" stroke="#000" stroke-width="1" />

        <!-- Major tick marks (every 30°) -->
        <line class="major" y1="35" y2="45" transform="rotate(0)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(30)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(60)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(90)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(120)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(150)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(180)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(210)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(240)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(270)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(300)" stroke="#000" stroke-width="1"/>
        <line class="major" y1="35" y2="45" transform="rotate(330)" stroke="#000" stroke-width="1"/>

        <line class="minor" y1="42" y2="45" transform="rotate(6)" />
        <line class="minor" y1="42" y2="45" transform="rotate(12)" />
        <line class="minor" y1="42" y2="45" transform="rotate(18)" />
        <line class="minor" y1="42" y2="45" transform="rotate(24)" />

        <line class="minor" y1="42" y2="45" transform="rotate(36)" />
        <line class="minor" y1="42" y2="45" transform="rotate(42)" />
        <line class="minor" y1="42" y2="45" transform="rotate(48)" />
        <line class="minor" y1="42" y2="45" transform="rotate(54)" />

        <line class="minor" y1="42" y2="45" transform="rotate(66)" />
        <line class="minor" y1="42" y2="45" transform="rotate(72)" />
        <line class="minor" y1="42" y2="45" transform="rotate(78)" />
        <line class="minor" y1="42" y2="45" transform="rotate(84)" />

        <line class="minor" y1="42" y2="45" transform="rotate(96)" />
        <line class="minor" y1="42" y2="45" transform="rotate(102)" />
        <line class="minor" y1="42" y2="45" transform="rotate(108)" />
        <line class="minor" y1="42" y2="45" transform="rotate(114)" />

        <line class="minor" y1="42" y2="45" transform="rotate(126)" />
        <line class="minor" y1="42" y2="45" transform="rotate(132)" />
        <line class="minor" y1="42" y2="45" transform="rotate(138)" />
        <line class="minor" y1="42" y2="45" transform="rotate(144)" />

        <line class="minor" y1="42" y2="45" transform="rotate(156)" />
        <line class="minor" y1="42" y2="45" transform="rotate(162)" />
        <line class="minor" y1="42" y2="45" transform="rotate(168)" />
        <line class="minor" y1="42" y2="45" transform="rotate(174)" />

        <line class="minor" y1="42" y2="45" transform="rotate(186)" />
        <line class="minor" y1="42" y2="45" transform="rotate(192)" />
        <line class="minor" y1="42" y2="45" transform="rotate(198)" />
        <line class="minor" y1="42" y2="45" transform="rotate(204)" />

        <line class="minor" y1="42" y2="45" transform="rotate(216)" />
        <line class="minor" y1="42" y2="45" transform="rotate(222)" />
        <line class="minor" y1="42" y2="45" transform="rotate(228)" />
        <line class="minor" y1="42" y2="45" transform="rotate(234)" />

        <line class="minor" y1="42" y2="45" transform="rotate(246)" />
        <line class="minor" y1="42" y2="45" transform="rotate(252)" />
        <line class="minor" y1="42" y2="45" transform="rotate(258)" />
        <line class="minor" y1="42" y2="45" transform="rotate(264)" />

        <line class="minor" y1="42" y2="45" transform="rotate(276)" />
        <line class="minor" y1="42" y2="45" transform="rotate(282)" />
        <line class="minor" y1="42" y2="45" transform="rotate(288)" />
        <line class="minor" y1="42" y2="45" transform="rotate(294)" />

        <line class="minor" y1="42" y2="45" transform="rotate(306)" />
        <line class="minor" y1="42" y2="45" transform="rotate(312)" />
        <line class="minor" y1="42" y2="45" transform="rotate(318)" />
        <line class="minor" y1="42" y2="45" transform="rotate(324)" />

        <line class="minor" y1="42" y2="45" transform="rotate(336)" />
        <line class="minor" y1="42" y2="45" transform="rotate(342)" />
        <line class="minor" y1="42" y2="45" transform="rotate(348)" />

        <line class="hour" y1="2" y2="-20" />

        <line class="minute" y1="4" y2="-30" />

        <g class="second">
            <line class="second-hand" y1="10" y2="-38" />
            <line class="second-counterweight" y1="10" y2="2" />
        </g>
    </svg>

    <div id="wifi-mode">
        <span class="material-symbols-outlined">
        </span>
    </div>

    <iframe id="slot-1"  data-hour="1"  class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-2"  data-hour="2"  class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-3"  data-hour="3"  class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-4"  data-hour="4"  class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-5"  data-hour="5"  class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-6"  data-hour="6"  class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-7"  data-hour="7"  class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-8"  data-hour="8"  class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-9"  data-hour="9"  class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-10" data-hour="10" class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-11" data-hour="11" class="clock-slot" sandbox="allow-scripts"></iframe>
    <iframe id="slot-12" data-hour="12" class="clock-slot" sandbox="allow-scripts"></iframe>
</div>

<script src="./src/main.js" type="module"></script>
<script src="./src/pluginHost.js" type="module"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const wifiModeEl = document.getElementById("wifi-mode");

        // Listen for the backend → frontend signal
        window.runtime.EventsOn("jetclock:wifi.mode", (mode) => {
            // mode might be “infra” (client), “ap” (hotspot), etc.
            let iconName;
            switch (mode) {
                case "ap":
                case "hotspot":
                    iconName = "cell_tower";
                    break;
                case "infra":
                case "wifi":
                default:
                    iconName = "wifi";
                    break;
            }

            // Replace the inner HTML with the new Material Symbol
            wifiModeEl.innerHTML = `
        <span class="material-symbols-outlined">
          ${iconName}
        </span>
      `;
        });
    });
</script>
<script>
    window.runtime.EventsOn("jetclock:plugin.loaded", (info) => {
        try {
            // info is already a JS object { token: "...", manifest: {...} }
            console.log("processing ", info);
            const token = info.token;
            // Compose the plugin UI URL—our Go server listens on /expose/<token>/
            const uiUrl = `http://localhost:3456/expose/${token}/`;

            // Assign the plugin UI into the next open slot
            window.assignPluginToNextSlot(token, uiUrl);
        } catch (e) {
            console.error("Error handling plugin.loaded:", e);
        }
    });
</script>
</body>
</html>
